# Installing jenkins & unit test tools on test.pear.php.net

# Old test runner
# Checkout relevant code, copy files to the correct spots
$ cd ~/
$ svn co http://svn.php.net/repository/pear/ci/phpuc/trunk phpuc
$ svn co http://svn.php.net/repository/pear/packages-all packages-all
$ svn co http://svn.php.net/repository/pear2/packages-all pear2-packages-all
$ php phpuc/checkout-github.php pear
$ cp phpuc/unit-test-results packages-all/unit-test-results
$ cp phpuc/run-tests.sh .
$ cp phpuc/migrate.php .
$ cp phpuc/tests.php packages-all
$ chmod +x run-tests.sh
$ chmod -R 777 packages-all/unit-test-results
$ sudo pear install phpunit/phpcpd

# Add a symlink from pearweb to your local folder
# TODO Rethink?
$ ln -s /var/www/html/pear_www/pear.php.net/public_html/unit-test-results ~/packages-all/unit-test-results

# Crontab:
2  *  *   *   *     ./run-tests.sh

sudo apt-get install sun-java6-jdk ant git-core
ln -s /usr/bin/java /bin/java

# Jenkins
apt-get install jenkins

# visit http://38.108.46.133:8080/cruisecontrol/

# Stop it
/etc/init.d/jenkins stop

# setup a specific project
cd ~/phpuc
# SVN
php generate-project.php Net_IPv6 ~/packages-all /var/lib/jenkins 
# GIT
php generate-project.php Log ~/github-pear-all /var/lib/jenkins

# setup all phpunit compatable projects!
php generate-all.php ~/packages-all /var/lib/jenkins ~/pyrus.phar
php generate-all.php ~/github-pear-all /var/lib/jenkins ~/pyrus.phar

/etc/init.d/jenkins restart

# Make sure you have PFM installed
pear install PEAR_PackageFileManager
